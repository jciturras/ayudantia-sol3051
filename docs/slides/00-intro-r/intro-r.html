<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Introducción a R   .small[Análisis de Datos Multinivel]</title>
    <meta charset="utf-8" />
    <meta name="author" content="Julio César Iturra Sanhueza" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <script src="libs/clipboard/clipboard.min.js"></script>
    <link href="libs/xaringanExtra-clipboard/xaringanExtra-clipboard.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-clipboard/xaringanExtra-clipboard.js"></script>
    <script>window.xaringanExtraClipboard(null, {"button":"<i class=\"fa fa-clipboard\"><\/i>","success":"<i class=\"fa fa-check\" style=\"color: #90BE6D\"><\/i>","error":"Press Ctrl+C to Copy"})</script>
    <link href="libs/font-awesome/css/all.css" rel="stylesheet" />
    <link href="libs/font-awesome/css/v4-shims.css" rel="stylesheet" />
    <link rel="stylesheet" href="xaringan-coes.css" type="text/css" />
    <link rel="stylesheet" href="https:\\cdnjs.cloudflare.com\ajax\libs\animate.css\3.7.0\animate.min.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Introducción a R <br> .small[Análisis de Datos Multinivel]
### Julio César Iturra Sanhueza
### Agosto, 2020

---

layout: true
class: animated, fadeIn

---
class: slideInRight






#Contenidos ayudantía
 
* ¿Qué es R?
* Interfaz de R-studio 
    - Consola
    - Sintáxis
    - Enviornment (objetos)
* Funciones básicas en R
    - Operadores lógicos
    - Transformaciones básicas
* Uso de Bases de Datos  
    - Cargar una base de datos
    - Tipos de datos 
    - Descripción de datos
---
class: inverse, middle, center

# ¿Qué es R?

---

## ¿Qué es **_R_** ?

1. R es un software libre, por tanto es totalmente gratuito y abierto. Tiene una comunidad a nivel mundial muy activa, donde se comparte
todo tipo de contenido relacionado con el análisis de datos.
2. Es un lenguaje de programación, de modo que también es posible que los usuarios elaboren sus propias funciones o "paquetes".

3. Tiene una fuerte orientación al análisis estadístico y visualización de datos.

4. Una de sus principales características es que posee una lógica de programación orientada a **Objetos** (Object Oriented programming). Lo veremos en detalle más adelante. 

5. El editor nativo de R es poco amigable para los usuarios. Por lo tanto, lo más adecuado es emplear una **Interfaz de Usuario** (IDE por *Integrated development environment*) 

  - [**RStudio**](https://www.rstudio.com/) será la interfaz que utilizaremos en el curso.

---

## `R` es una gran calculadora

* Una de las características principales de R es que nos permite emplearlo como una "base" para realizar cálculos matemáticos simples, como también emplear funciones complejas a través de paquetes especializados.

* Al ser una plataforma abierta, es posible utilizar una infinidad de paquetes que otros usuarios han desarrollado. Los paquetes son grupos de funciones que usuarios han programado con algún objetivo, el cual queda abierto a la comunidad para su libre acceso. 

Aquí hay algunos ejemplos:


```r
1+1
```

```
## [1] 2
```


```r
(100+100)/4
```

```
## [1] 50
```
---
## Programación orientada a objetos

* El hecho de R tenga una "orientación a objetos" tiene varias ventajas.

1. Es posible "guardar" nuestros objetos, los cuales pueden ser números, palabras, resultados, funciones, etc.
2. Al tenerlos "guardados" los podemos "llamar" cuando sea necesario. 
3. El símbolo `&lt;-` permite indicarle a R que queremos "guardar" un objeto


```r
a &lt;- 100 #Guardamos 100 dentro del objeto a
b &lt;- 4   #Guardamos 4 dentro del objeto b
c &lt;- 1+1 #Guardamos el resultado de 1+1 en c
```


```r
print(a)
```

```
## [1] 100
```


```r
print(a*b) #multiplicando a x b
```

```
## [1] 400
```
---


```r
d &lt;- (a*a)/b #a x a dividido b
print(d)
```

```
## [1] 2500
```

```r
#O su versión abreviada:
d
```

```
## [1] 2500
```


```r
d^2 #Estamos elevando al cuadrado al objeto e
```

```
## [1] 6250000
```

---
## Operadores en R (I)


| Operador | Descripción       |
|----------|-------------------|
| &lt;        | Menos que         |
| &gt;        | Mayor que         |
| &lt;=       | Menor o igual que |
| &gt;=       | Mayor o igual que |
| ==       | Igual que         |
| !=       | Distinto de       |



```r
x &lt;- 5
y &lt;- 16
x&lt;y
```

```
## [1] TRUE
```

---


```r
x&gt;y
```

```
## [1] FALSE
```

```r
x&lt;=5
```

```
## [1] TRUE
```

```r
y&gt;=20
```

```
## [1] FALSE
```

```r
y == 16
```

```
## [1] TRUE
```

```r
x != 5
```

```
## [1] FALSE
```

---

## Operadores en R (II)

|  Operador |          Comparación         |    Ejemplo    | Resultado |
|:---------:|:----------------------------:|:-------------:|:---------:|
| x `\(\mid\)` y| x Ó y es verdadero           | TRUE `\(\mid\)`FALSE | TRUE      |
| x &amp; y     | x Y y son verdaderos         | TRUE &amp; FALSE  | FALSE     |
| !x        | x no es verdadero (negación) | !TRUE         | FALSE     |
| isTRUE(x) | x es verdadero (afirmación)  | isTRUE(TRUE)  | TRUE      |

---


```r
TRUE|FALSE
```

```
## [1] TRUE
```

```r
TRUE &amp; FALSE
```

```
## [1] FALSE
```

```r
!TRUE
```

```
## [1] FALSE
```

```r
isTRUE(TRUE)
```

```
## [1] TRUE
```

---
class: inverse, middle, center

# RStudio 

---
# Interfaz de RStudio

RStudio se compone de varias partes, pero las más importarten son:


* **Sintaxis**: Es donde escribimos nuestro código

* **Consola**: Es donde podemos visualizar nuestros resultados 

* **Enviornment**: Es donde se "guardan" nuestros objetos 

* **Panel de visualización**: Aquí se visualizan nuestros gráficos y otro tipo de resultados.

---
class: top
.center[![:scale 74%](images/rstudio.png)] 

---
#Tipos de datos en R

* Numérico (numeric; números con decimales)
* Números enteros (integer)
* Lógicos: Verdadero o Falso
* Variables cadena o texto (string / character)
* Factores (factor): para variables cualitativas (nominales)

#Tipos de estructura de datos:

* Vector (vector) columna o fila de datos numéricos (una variable individual)
* Matrices (matrix): arreglo de dos dimenisones de datos numéricos (conjunto de variables)
* Data.frame (base de datos): Matriz de datos en el que las columnas tienen adignado nombres, y que permite usar todo tipo de datos.

&gt; Todos estos pueden ser tratados como objetos.

---

Ejemplo:

Crear dos objetos:


```r
x &lt;- 1:20
x
```

```
##  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20
```

```r
z &lt;- NA
z
```

```
## [1] NA
```

- x es un vector numérico que incluye valores discretos de 1 a 20
- z es un objeto sin valor/información (NA) 

Manipulemos z en base a x: 


```r
z[x&gt;=8] &lt;- 1
z
```

```
##  [1] NA NA NA NA NA NA NA  1  1  1  1  1  1  1  1  1  1  1  1  1
```

---


```r
z[x&lt;15] &lt;- 0
z
```

```
##  [1] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 1 1 1 1
```


```r
z &lt;- ifelse(test = x&gt;5, yes = 1, no = 0)
z
```

```
##  [1] 0 0 0 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
```

---

# Matrices y data frame

Creamos un vector `x` con valores de 1 a 20:


```r
x &lt;- 1:20
x[2]
```

```
## [1] 2
```

```r
x[2:3]
```

```
## [1] 2 3
```

```r
x[c(2:3,10:15)]
```

```
## [1]  2  3 10 11 12 13 14 15
```


---

Creamos una matriz en base a los objetos `x` y `z`:


```r
w &lt;- cbind(x, z)
w
```

```
##        x z
##  [1,]  1 0
##  [2,]  2 0
##  [3,]  3 0
##  [4,]  4 0
##  [5,]  5 0
##  [6,]  6 1
##  [7,]  7 1
##  [8,]  8 1
##  [9,]  9 1
## [10,] 10 1
##  [ reached getOption("max.print") -- omitted 10 rows ]
```

* La función `cbind()` nos permite unir dos elementos en forma de columnas (por eso la c).  

---

Exploremos la matriz que creamos usando: `matrix[row, column]`: 


```r
w[1,] 
```

```
## x z 
## 1 0
```

```r
w[1:5,]
```

```
##      x z
## [1,] 1 0
## [2,] 2 0
## [3,] 3 0
## [4,] 4 0
## [5,] 5 0
```

```r
w[,1]  
```

```
##  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20
```


---

Creamos un data.frame `d` en base a la información de la matriz `w` usando la función `data.frame()`: 


```r
d &lt;- data.frame(w)
d$x
```

```
##  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20
```

```r
d$z
```

```
##  [1] 0 0 0 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
```

```r
d$x + d$z
```

```
##  [1]  1  2  3  4  5  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21
```


```r
head(d,n = 5) # vemos las primeras 5 observaciones
```

```
##   x z
## 1 1 0
## 2 2 0
## 3 3 0
## 4 4 0
## 5 5 0
```


---

# Abrir una Base de datos:

* Para introducir datos en R es posible emplear distintas formas:

1. A través de comando para leer texto (read.txt, read.csv)
2. Empleando librerías complementarias con funcionalidades para importar bases provenientes de otros programas:


```r
install.packages("haven") #cargar .sav (SPSS)
library(haven) #Cargar la librería
```



Cargar una base de datos desde internet




```r
tt &lt;- read_sav(url("https://jciturras.github.io/ayudantia-sol3051/slides/00-intro-r/data/titanic2.sav")) 
tt &lt;- read.csv(url("https://jciturras.github.io/ayudantia-sol3051/slides/00-intro-r/data/titanic.csv"))
```





---
# Exploración de datos

&gt; `datos$variable`


```r
class(tt) #ver el tipo de datos 
class(tt$sex) #¿qué tipo de variable es sex?
class(tt$age) #¿qué tipo de variable es age?
class(tt$pclass) #¿qué tipo de variable es pclass?
```

```
## [1] "data.frame"
## [1] "character"
## [1] "numeric"
## [1] "character"
```


```r
str(tt) #Contenido y estructura de la base de datos
```

```
## 'data.frame':	1046 obs. of  8 variables:
##  $ X       : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ pclass  : chr  "Clase Alta" "Clase Alta" "Clase Alta" "Clase Alta" ...
##  $ survived: chr  "Sobrevive" "Sobrevive" "No sobrevive" "No sobrevive" ...
##  $ name    : chr  "Allen, Miss. Elisabeth Walton" "Allison, Master. Hudson Trevor" "Allison, Miss. Helen Loraine" "Allison, Mr. Hudson Joshua Creighton" ...
##  $ sex     : chr  "Mujer" "Hombre" "Mujer" "Hombre" ...
##  $ age     : num  29 0.917 2 30 25 ...
##  $ sibsp   : int  0 1 1 1 1 0 1 0 2 0 ...
##  $ parch   : int  0 2 2 2 2 0 0 0 0 0 ...
```

---
# Describamos nuestros datos


```r
summary(tt$age) #Estadísticos descriptivos
```

```
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.1667 21.0000 28.0000 29.8811 39.0000 80.0000
```

```r
mean(tt$age) #Media de edad
```

```
## [1] 29.88113
```

```r
sd(tt$age) #desviación estándar de edad
```

```
## [1] 14.4135
```

```r
summary.factor(tt$sex) # ¿cuántos hombres y mujeres hay?
```

```
## Hombre  Mujer 
##    658    388
```

---

```r
summary.factor(tt$pclass) #Con summary también podemos ver un factor
```

```
##       Clase Alta       Clase Baja Clase Intermedia 
##              284              501              261
```

```r
table(tt$pclass) #Otra alternativa
```

```
## 
##       Clase Alta       Clase Baja Clase Intermedia 
##              284              501              261
```

```r
prop.table(table(tt$pclass)) #Vemos las proporciones
```

```
## 
##       Clase Alta       Clase Baja Clase Intermedia 
##        0.2715105        0.4789675        0.2495220
```

```r
table(tt$pclass, tt$sex) #tabla cruzada sexo y clase social
```

```
##                   
##                    Hombre Mujer
##   Clase Alta          151   133
##   Clase Baja          349   152
##   Clase Intermedia    158   103
```

---

## Ejemplo con regresión 

**Tranformamos `survived` en una variable dummy: **


```r
table(tt$survived)
```

```
## 
## No sobrevive    Sobrevive 
##          619          427
```

```r
tt$surv&lt;- ifelse(tt$survived=="Sobrevive",yes = 1,no = 0)
table(tt$surv)
```

```
## 
##   0   1 
## 619 427
```

**Estimamos un modelo usando `sex` y `pclass` como predictores de `surv`:**


```r
logit01&lt;- glm(formula = surv~sex+pclass,data = tt,family = "binomial")
```

---

**Exploramos el objeto `logit01`**


```r
class(logit01)
```

```
## [1] "glm" "lm"
```


### ¿Qué tipo de información contiene?


```r
logit01
```

```
## 
## Call:  glm(formula = surv ~ sex + pclass, family = "binomial", data = tt)
## 
## Coefficients:
##            (Intercept)                sexMujer        pclassClase Baja  pclassClase Intermedia  
##                -0.3682                  2.5281                 -1.7189                 -0.8984  
## 
## Degrees of Freedom: 1045 Total (i.e. Null);  1042 Residual
## Null Deviance:	    1415 
## Residual Deviance: 1014 	AIC: 1022
```

---

### Revisemos los coeficientes:

```r
logit01$coefficients
```

```
##            (Intercept)               sexMujer       pclassClase Baja pclassClase Intermedia 
##             -0.3682364              2.5280910             -1.7189465             -0.8983816
```

```r
coef(logit01)
```

```
##            (Intercept)               sexMujer       pclassClase Baja pclassClase Intermedia 
##             -0.3682364              2.5280910             -1.7189465             -0.8983816
```

---

### Valores predichos y residuos:




```r
logit01$fitted.values
```

```
##         1         2         3         4         5         6         7         8         9        10 
## 0.8965861 0.4089672 0.8965861 0.4089672 0.8965861 0.4089672 0.8965861 0.4089672 0.8965861 0.4089672 
##        11        12        13        14        15        16        17        18        19        20 
## 0.4089672 0.8965861 0.8965861 0.8965861 0.4089672 0.4089672 0.8965861 0.8965861 0.4089672 0.4089672 
##  [ reached getOption("max.print") -- omitted 1026 entries ]
```

```r
logit01$residuals
```

```
##         1         2         3         4         5         6         7         8         9        10 
##  1.115342  2.445184 -9.669877 -1.691954 -9.669877  2.445184  1.115342 -1.691954  1.115342 -1.691954 
##        11        12        13        14        15        16        17        18        19        20 
## -1.691954  1.115342  1.115342  1.115342  2.445184 -1.691954  1.115342  1.115342 -1.691954  2.445184 
##  [ reached getOption("max.print") -- omitted 1026 entries ]
```

---

### Resumen del modelo: 


```r
summary(logit01)
```

```
## 
## Call:
## glm(formula = surv ~ sex + pclass, family = "binomial", data = tt)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.1303  -0.7046  -0.4836   0.7062   2.0996  
## 
## Coefficients:
##                        Estimate Std. Error z value             Pr(&gt;|z|)    
## (Intercept)             -0.3682     0.1489  -2.473               0.0134 *  
## sexMujer                 2.5281     0.1632  15.489 &lt; 0.0000000000000002 ***
## pclassClase Baja        -1.7189     0.1910  -8.999 &lt; 0.0000000000000002 ***
## pclassClase Intermedia  -0.8984     0.2082  -4.316            0.0000159 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 1414.6  on 1045  degrees of freedom
## Residual deviance: 1013.8  on 1042  degrees of freedom
## AIC: 1021.8
## 
## Number of Fisher Scoring iterations: 4
```

---
# Algunos tips

* Para crear códigos es útil mantener buenas prácticas con el objetivo de que ustedes recuerden lo que han hecho, como también para que otras personas puedan comprender su trabajo.
 
1. Comentar código. En R se utiliza el símbolo **`#`** para crear comentarios
2. Utilizar secciones en el código, de modo que se sepa cuando comienza y termina un procedimiento.
3. Cuando realicen algún procedimiento más complejo, describirlo en detalle. 


```r
#Codigo de Julio Iturra -  jciturra@uc.cl
#Fecha: 17.10.2018

# Mi primera sección -------------------------------------------
#Creación de "a" en base a "b", b = 45
b &lt;- 45 #creamos b
a &lt;- b  #creamos a en base b

print(a) #comprobemos si "a" está OK
```

```
## [1] 45
```

---
class: center, middle

# Consultas al correo julioiturrasanhueza@gmail.com

Slides created via the R package [**xaringan**](https://github.com/yihui/xaringan),
 [**knitr**](http://yihui.name/knitr), y [R Markdown](https://rmarkdown.rstudio.com).
 
---
class: slideInRight
## Actividad

Empleando la base "titanic", realice algunos procedimientos de exploración y análisis de datos.

1. Observe el tipo de estructura de datos que está empleando.

1. En base a la base señalada, observe su "estructura" 

1. Observe qué tipo/clase de variable es: `sex`, `pclass`, `age` y `survived`
 
1. Según esto, determine cuál comando va emplear para describir las variables.

1. Construya una tabla de contingencia (filas x columnas): `survived` x `pclass` 

1. Estime un modelo de regresión logística para `surv` con los predictores `sex`, `age` y `pclass`.

1. Obtenga el resumen del modelo y responda:

   - ¿Cuál es el valor del coeficiente de regresión de `age`?


---
# Base de datos 

| Nombre   	| Descripción                        	| Valores 	| Categorías       	|
|----------	|------------------------------------	|---------	|------------------	|
| pclass   	| Clase del pasajero/a               	| 1       	| Clase Alta       	|
|          	|                                    	| 2       	| Clase Intermedia 	|
|          	|                                    	| 3       	| Clase Baja       	|
| survived 	| Estatus sobrevivencia              	| 1       	| No sobrevive     	|
|          	|                                    	| 2       	| Sobrevive        	|
| name     	| Nombre                             	|         	|                  	|
| sex      	| Sexo pasajero/a                    	| 1       	| Hombre           	|
|          	|                                    	| 2       	| Mujer            	|
| age      	| Edad pasajero/a                    	|         	| rango: 0.2-80.0  	|
| sibsp    	| Número de parientes                	|         	| rango: 0-8       	|
| parch    	| Número de padres / niños a bordo   	|         	| rango: 0-9       	|
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="macros.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"countIncrementalSlides": false,
"slideNumberFormat": "<div class=\"progress-bar-container\">   <div class=\"progress-bar\" style=\"width: calc(%current% / %total% * 100%);\">   </div> </div>` "
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
